<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Indah & Arif - Invitation</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:"Poppins",sans-serif;background:#fffdf8;color:#333}
    .wrap{max-width:960px;margin:0 auto;padding:28px}
    h1{font-family:"Playfair Display",serif;text-align:center;color:#2b2b2b}
    section{background:#fff;padding:20px;border-radius:12px;margin:18px 0;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    h2{font-family:"Playfair Display",serif;color:#d4af37;margin:6px 0 12px}
    .guestform input,.guestform textarea{width:100%;padding:10px;border:1px solid #eee;border-radius:8px;margin-top:8px}
    .btn-send{background:#d4af37;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer;margin-top:8px}
    .messages{margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:420px;overflow:auto}
    .msg{padding:12px;border-radius:10px;background:#fff;border-left:4px solid rgba(212,175,55,0.6)}
    .meta{color:#777;font-size:13px;margin-top:6px}
    .audio-toggle{position:fixed;right:18px;bottom:18px;background:#d4af37;color:#111;border-radius:999px;border:none;padding:12px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>The Wedding of Indah &amp; Arif</h1>
    <p style="text-align:center;color:#666">â€œGlory be to Allah who created everything in pairs.â€</p>

    <section>
      <h2>Bride &amp; Groom</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <strong>Nur Indah Sari, S.M.</strong><div style="color:#666;margin-top:6px">Second daughter of Bapak Maggalatung &amp; (Almh.) Ibu Sumarni</div>
        </div>
        <div>
          <strong>Muhammad Arif, S.A.P.</strong><div style="color:#666;margin-top:6px">Third son of Bapak H. Ruslan &amp; Ibu Hj. Nurlela</div>
        </div>
      </div>
    </section>

    <section>
      <h2>Ceremony & Reception</h2>
      <p><strong>Akad Nikah:</strong> Wednesday, December 3, 2025 â€” 11:00 WITA</p>
      <p><strong>Resepsi:</strong> 11:00 WITA â€“ Until finish</p>
      <p>Location: Jl. Poros Kulampuâ€“Solo, Dusun Aluppange, Desa Alewadeng, Kec. Sajoanging, Kab. Wajo</p>
      <p><a href="https://maps.app.goo.gl/52bUetkWoo8VFB3g8" target="_blank">ğŸ“ View on Google Maps</a></p>
    </section>

    <section>
      <h2>Prayer &amp; Wishes</h2>
      <p style="color:#444">Ø¨ÙØ§Ø±ÙÙƒÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙÙƒÙØŒ ÙˆÙØ¨ÙØ§Ø±ÙÙƒÙ Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙØŒ ÙˆÙØ¬ÙÙ…ÙØ¹Ù Ø¨ÙÙŠÙ’Ù†ÙÙƒÙÙ…ÙØ§ ÙÙÙŠ Ø®ÙÙŠÙ’Ø±Ù</p>
      <p style="color:#777;margin-top:6px"><em>Barakallahu laka wa baraka 'alaika wajama'a bainakuma fii khairin</em></p>

      <!-- Guestbook form -->
      <div class="guestform" style="margin-top:12px">
        <input id="name" placeholder="Your name" />
        <textarea id="message" rows="3" placeholder="Write your prayer or short message"></textarea>
        <div style="display:flex;gap:10px;align-items:center">
          <button id="sendBtn" class="btn-send">Send</button>
          <button id="clearLocal" style="background:#eee;border:none;padding:10px;border-radius:8px;cursor:pointer">Clear local copy</button>
        </div>

        <div id="messages" class="messages" aria-live="polite" style="margin-top:14px"></div>
      </div>
    </section>

    <section>
      <h2>Countdown</h2>
      <div id="countdown" style="font-weight:700;text-align:center"></div>
      <div style="text-align:center;color:#777;margin-top:8px">Event: December 3, 2025 â€” 11:00 WITA</div>
    </section>

    <p style="text-align:center;margin-top:28px;color:#666">With love â€” <strong>Nur Indah Sari &amp; Muhammad Arif</strong></p>
  </div>

  <!-- persistent audio element (will be created if session indicates) -->
  <audio id="player" src="soft-piano-music-10-minutes-long-231315.mp3" loop></audio>
  <button id="audioToggle" class="audio-toggle" aria-label="Toggle music">ğŸ”‡</button>

  <script>
  // === CONFIG: ganti BIN_ID & API_KEY dengan data JSONBin mu ===
  const JSONBIN_ENABLED = true; // set false untuk disable JSONBin
  const BIN_ID = 'REPLACE_BIN_ID_HERE';          // <-- ganti
  const JSONBIN_API_KEY = 'REPLACE_API_KEY_HERE';// <-- ganti
  const JSONBIN_BASE = 'https://api.jsonbin.io/v3/b'; // JSONBin V3 endpoint

  // === Utility: simple profanity filter (very basic) ===
  const badWords = ['fuck','shit','bitch','anjing','bangsat']; // contoh; bisa perluas
  function sanitizeText(s){
    if(!s) return s;
    let out = String(s);
    badWords.forEach(w=>{
      const re = new RegExp(w,'gi');
      out = out.replace(re, '***');
    });
    return out;
  }

  // === Countdown ===
  (function(){
    const target = Date.UTC(2025,11,3,3,0,0); // 2025-12-03 03:00 UTC == 11:00 WITA
    const el = document.getElementById('countdown');
    function update(){
      const now = Date.now();
      let diff = target - now;
      if(diff<=0){ el.textContent='Wedding Day â€” Congratulations!'; return; }
      const d = Math.floor(diff/(1000*60*60*24));
      diff -= d*(1000*60*60*24);
      const h = Math.floor(diff/(1000*60*60));
      diff -= h*(1000*60*60);
      const m = Math.floor(diff/(1000*60));
      diff -= m*(1000*60);
      const s = Math.floor(diff/1000);
      el.textContent = `${d} days Â· ${String(h).padStart(2,'0')} : ${String(m).padStart(2,'0')} : ${String(s).padStart(2,'0')}`;
    }
    update(); setInterval(update,1000);
  })();

  // === Audio persist across pages using session flag ===
  (function(){
    const audio = document.getElementById('player');
    const toggle = document.getElementById('audioToggle');
    // If arrived from cover and session indicates persistAudio, attempt play
    try{
      if(sessionStorage.getItem('persistAudio') === 'true'){
        const p = audio.play();
        if(p !== undefined) p.catch(()=>{ /* blocked */ });
        sessionStorage.removeItem('persistAudio');
        toggle.textContent = 'ğŸ”Š';
      } else {
        // attempt silent autoplay (may fail)
        const p = audio.play();
        if(p !== undefined) p.catch(()=>{ toggle.textContent = 'ğŸ”‡'; });
      }
    }catch(e){}

    // toggle control
    toggle.addEventListener('click', ()=>{
      if(audio.paused){ audio.play(); toggle.textContent = 'ğŸ”Š'; }
      else{ audio.pause(); toggle.textContent = 'ğŸ”‡'; }
    });
  })();

  // === Guestbook: JSONBin integration with fallback to localStorage ===
  (function(){
    const messagesEl = document.getElementById('messages');
    const nameInput = document.getElementById('name');
    const msgInput = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const clearLocalBtn = document.getElementById('clearLocal');

    const LOCAL_KEY = 'indah_arif_guest_local_v1';

    // Render helper (chronological: oldest on top)
    function renderMessages(arr){
      messagesEl.innerHTML = '';
      if(!arr || !arr.length) { messagesEl.innerHTML = '<div style="color:#777">No wishes yet â€” be the first to send one.</div>'; return; }
      // arr assumed chronological (oldest first)
      arr.forEach(item=>{
        const d = new Date(item.t || item.timestamp || 0);
        const div = document.createElement('div');
        div.className = 'msg';
        const name = sanitizeText(item.name || 'Anonymous');
        const msg = sanitizeText(item.message || item.msg || '');
        div.innerHTML = `<strong>${escapeHtml(name)}</strong><div style="color:#555;margin-top:6px">${escapeHtml(msg)}</div><div class="meta">${d.toLocaleString()}</div>`;
        messagesEl.appendChild(div);
      });
    }

    // Escape helper
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // Fetch from JSONBin
    async function fetchFromJSONBin(){
      if(!JSONBIN_ENABLED || BIN_ID.includes('REPLACE')) return null;
      try{
        const res = await fetch(`${JSONBIN_BASE}/${BIN_ID}/latest`, { method:'GET', headers: { 'X-Master-Key': JSONBIN_API_KEY } });
        if(!res.ok) throw new Error('Fetch failed');
        const data = await res.json();
        // JSONBin v3 wraps data in record.record
        const record = data && data.record ? data.record : data;
        // Expect record to be an array
        if(Array.isArray(record)) return record;
        return null;
      }catch(e){
        console.warn('JSONBin fetch failed', e);
        return null;
      }
    }

    // Save to JSONBin (append)
    async function appendToJSONBin(entry){
      if(!JSONBIN_ENABLED || BIN_ID.includes('REPLACE')) return false;
      try{
        // Read current
        const cur = await fetchFromJSONBin();
        let arr = Array.isArray(cur) ? cur.slice() : [];
        arr.push({ name: entry.name, message: entry.message, t: Date.now() });
        // overwrite bin with new array
        const res = await fetch(`${JSONBIN_BASE}/${BIN_ID}`, { 
          method: 'PUT',
          headers: {
            'Content-Type':'application/json',
            'X-Master-Key': JSONBIN_API_KEY
          },
          body: JSON.stringify(arr)
        });
        return res.ok;
      }catch(e){
        console.warn('appendToJSONBin failed', e);
        return false;
      }
    }

    // Local fallback storage functions (also keep chronological, push to end)
    function loadLocal(){ return JSON.parse(localStorage.getItem(LOCAL_KEY) || '[]'); }
    function saveLocal(arr){ localStorage.setItem(LOCAL_KEY, JSON.stringify(arr)); }

    // Initial load: try JSONBin -> fallback to local
    (async function init(){
      let arr = await fetchFromJSONBin();
      if(arr && Array.isArray(arr)) { renderMessages(arr); return; }
      // fallback
      arr = loadLocal();
      renderMessages(arr);
    })();

    // Send handler: first try JSONBin append; if fails, save to local
    sendBtn.addEventListener('click', async ()=>{
      const name = (nameInput.value || '').trim();
      const msg = (msgInput.value || '').trim();
      if(!name || !msg) return alert('Please enter your name and message.');
      const entry = { name: sanitizeText(name), message: sanitizeText(msg) };

      // Try JSONBin
      const ok = await appendToJSONBin(entry);
      if(ok){
        // re-fetch and render from JSONBin to ensure all visitors see same order
        const arr = await fetchFromJSONBin();
        if(arr && Array.isArray(arr)){ renderMessages(arr); nameInput.value=''; msgInput.value=''; return; }
      }

      // If JSONBin disabled or failed, fallback to local
      const arrLocal = loadLocal();
      arrLocal.push({ name: entry.name, message: entry.message, t: Date.now() });
      saveLocal(arrLocal);
      renderMessages(arrLocal);
      nameInput.value=''; msgInput.value='';
    });

    clearLocalBtn.addEventListener('click', ()=>{
      if(confirm('Clear local stored guest wishes? This will only remove local copy, not remote JSONBin data.')){
        localStorage.removeItem(LOCAL_KEY);
        renderMessages([]);
      }
    });

  })();
  </script>
</body>
</html>
